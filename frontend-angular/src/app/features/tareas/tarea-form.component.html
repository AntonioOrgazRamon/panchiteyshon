<h1>{{ isEdit() ? 'Editar tarea' : 'Nueva tarea' }}</h1>
<app-alert [message]="message()" type="error" />
@if (loading()) {
  <app-loader />
} @else {
  <form [formGroup]="form" (ngSubmit)="submit()" class="card card-body">
    <div class="mb-2">
      <label class="form-label">Título *</label>
      <input type="text" class="form-control" formControlName="titulo" />
      @if (form.get('titulo')?.invalid && form.get('titulo')?.touched) {
        <small class="text-danger">Título requerido</small>
      }
    </div>
    <div class="mb-2">
      <label class="form-label">Descripción</label>
      <textarea class="form-control" formControlName="descripcion" rows="2"></textarea>
    </div>
    <div class="row g-2">
      <div class="col-md-4">
        <label class="form-label">Tipo</label>
        <select class="form-select" formControlName="tipo">
          <option value="seguimiento">seguimiento</option>
          <option value="reunion">reunion</option>
          <option value="interna">interna</option>
          <option value="recordatorio">recordatorio</option>
        </select>
      </div>
      <div class="col-md-4">
        <label class="form-label">Estado</label>
        <select class="form-select" formControlName="estado">
          <option value="pendiente">pendiente</option>
          <option value="en_progreso">en_progreso</option>
          <option value="hecha">hecha</option>
          <option value="cancelada">cancelada</option>
        </select>
      </div>
      <div class="col-md-4">
        <label class="form-label">Prioridad</label>
        <select class="form-select" formControlName="prioridad">
          <option value="baja">baja</option>
          <option value="media">media</option>
          <option value="alta">alta</option>
        </select>
      </div>
    </div>
    <div class="row g-2 mb-2">
      <div class="col-md-6">
        <label class="form-label">Lead</label>
        <select class="form-select" formControlName="leadId">
          <option [value]="null">— Sin lead —</option>
          @for (l of leads(); track l.id) {
            <option [value]="l.id">{{ l.nombre }} — {{ l.empresa }}</option>
          }
        </select>
      </div>
      <div class="col-md-6">
        <label class="form-label">Cliente</label>
        <select class="form-select" formControlName="clienteId">
          <option [value]="null">— Sin cliente —</option>
          @for (c of clientes(); track c.id) {
            <option [value]="c.id">{{ c.nombreContacto }} — {{ c.empresa }}</option>
          }
        </select>
      </div>
    </div>
    <div class="mb-2">
      <label class="form-label">Categoría planificación</label>
      <select class="form-select" formControlName="categoriaPlanificacion">
        <option value="puntual">puntual</option>
        <option value="diaria">diaria</option>
        <option value="semanal">semanal</option>
      </select>
    </div>
    <div class="row g-2">
      <div class="col-md-4">
        <label class="form-label">Fecha vencimiento</label>
        <input type="date" class="form-control" formControlName="fechaVencimiento" />
      </div>
      <div class="col-md-4">
        <label class="form-label">Fecha recordatorio</label>
        <input type="date" class="form-control" formControlName="fechaRecordatorio" />
      </div>
      <div class="col-md-4">
        <label class="form-label">Completada</label>
        <div class="form-check mt-2">
          <input type="checkbox" class="form-check-input" formControlName="completada" />
        </div>
      </div>
    </div>
    <div class="mt-3">
      <button type="submit" class="btn btn-primary" [disabled]="form.invalid">Guardar</button>
      <a routerLink="/tareas" class="btn btn-secondary ms-2">Cancelar</a>
    </div>
  </form>
}
